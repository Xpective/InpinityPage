<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inpinity - Staking</title>
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <link rel="stylesheet" href="css/dark.css" />
    <link rel="stylesheet" href="css/light.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/color.css" />
    <link rel="stylesheet" href="css/adapted_about_us.css" />
    <link rel="stylesheet" href="css/adapted_advertisements.css" />
    <link rel="stylesheet" href="css/adapted_combined.css"/>
    <link rel="stylesheet" href="css/adapted_comunity_guidelines.css" />
    <link rel="stylesheet" href="css/adapted_course_feedback.css" />
    <link rel="stylesheet" href="css/adapted_mft_marketplace.css"/>
    <link rel="stylesheet" href="css/adapted_profile.css"/>
    <link rel="stylesheet" href="css/combined_latest.css"/>
    <link rel="stylesheet" href="css/gamification.css" />
    <link rel="stylesheet" href="css/referral.css"/>
    <script defer src="main.js"></script>
    <!-- Ethers.js for blockchain interaction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link rel="icon" type="image/png" href="favicon.webp">
    <meta name="keywords" content="Inpinity, Game Design, Game Development, Platform, Collaboration, Forum, Tools, GameDesign, AI Development, Games of future, programming, programs, python gui, staking">
    <meta name="author" content="Xpective">
    <meta property="og:title" content="Inpinity - Staking">
    <meta property="og:description" content="Stake your $INPI tokens and earn passive rewards.">
    <meta property="og:image" content="logo_background.jpg">
    <meta property="og:url" content="https://inpinity.online/staking.html">
    <meta name="twitter:card" content="logo_background.webp">
    <meta name="twitter:site" content="@unxpective">
    <meta name="twitter:creator" content="@Inpinity1">
    <meta name="theme-color" content="#FarbcodeIhrerWebsite">
    <meta name="robots" content="index,follow">
    <style>
        /* Staking page specific styles */
        .staking-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(20, 20, 20, 0.9);
            border-radius: 8px;
            border: 1px solid var(--quinary-color, gold);
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
            color: #eee;
        }
        .staking-container h1 {
            color: gold;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }
        .partners-section {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin: 2rem auto;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            max-width: 600px;
        }
        .partner-item a {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: #2a2a2a;
            border: 1px solid gold;
            border-radius: 40px;
            color: gold;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.2s;
        }
        .partner-item a:hover {
            background: gold;
            color: black;
            transform: scale(1.05);
        }
        .wallet-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #1a1a1a;
            border-radius: 8px;
        }
        .wallet-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .connect-wallet-btn {
            background: gold;
            color: black;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .connect-wallet-btn:hover {
            transform: scale(1.05);
        }
        .wallet-details {
            background: #222;
            padding: 0.5rem 1rem;
            border-radius: 40px;
            border: 1px solid gold;
            color: gold;
            font-size: 0.9rem;
        }
        .balance-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .balance-card {
            background: #1a1a1a;
            border: 1px solid gold;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }
        .balance-card h3 {
            color: gold;
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .balance-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }
        .balance-card .label {
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .staking-form {
            background: #1a1a1a;
            border: 1px solid gold;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
        }
        .staking-form h2 {
            color: gold;
            margin-top: 0;
        }
        .form-group {
            margin: 1.5rem 0;
        }
        .form-group label {
            display: block;
            color: gold;
            margin-bottom: 0.5rem;
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            background: #222;
            border: 1px solid #444;
            border-radius: 4px;
            color: white;
            font-size: 1rem;
        }
        .form-group input:focus {
            outline: none;
            border-color: gold;
            box-shadow: 0 0 5px gold;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .action-btn {
            background: gold;
            color: black;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            flex: 1;
            min-width: 150px;
        }
        .action-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 0 15px gold;
        }
        .action-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .action-btn.secondary {
            background: #444;
            color: gold;
            border: 1px solid gold;
        }
        .action-btn.secondary:hover:not(:disabled) {
            background: #555;
        }
        .info-note {
            background: #2a2a2a;
            border-left: 4px solid gold;
            padding: 1rem;
            margin: 1rem 0;
            color: #ccc;
        }
        .info-note strong {
            color: gold;
        }
        .warning-note {
            background: #332211;
            border: 1px solid #ffaa00;
            border-radius: 8px;
            padding: 1rem;
            margin: 2rem auto;
            max-width: 800px;
            text-align: center;
        }
        .warning-note a {
            color: gold;
        }
        .reward-rate {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 1rem 0;
            padding: 1rem;
            background: #222;
            border-radius: 8px;
        }
        .rate-item {
            text-align: center;
        }
        .rate-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: gold;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a aria-label="Home" href="index.html">Home</a></li>
                <li><a aria-label="Features" href="features.html">Features</a></li>
                <li><a aria-label="Game" href="game.html">Game</a></li>
                <li><a aria-label="Forum" href="forum.html">Forum</a></li>
                <li><a aria-label="Collaboration" href="collaboration.html">Collaboration</a></li>
                <li><a aria-label="Register" href="register.html">Register</a></li>
                <li><a aria-label="About" href="about.html">About</a></li>
                <li><a aria-label="Whitepaper" href="https://github.com/Xpective/InpinityPage/raw/3923cf22782286d60574c8ae9b92e693cb314215/Inpinity%20Whitepaper%20.pdf" target="_blank" rel="noopener">Whitepaper</a></li>
                <li><a aria-label="FAQ" href="faq.html">FAQ</a></li>
                <li><a aria-label="Guestbook" href="guestbook.html">Guestbook</a></li>
                <li><a aria-label="Advertising" href="advertising.html">Advertising</a></li>
                <li><a aria-label="Profile" href="profile.html">Profile</a></li>
                <li><a aria-label="Staking" href="staking.html">Staking</a></li>
                <div class="themeDots">
                    <div class="dot light" title="Light Theme"></div>
                    <div class="dot dark" title="Dark Theme"></div>
                    <div class="dot basic" title="Basic Theme"></div>
                </div>
            </ul>
        </nav>
        <style>
            .themeDots .dot {
                display: inline-block;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                margin: 5px;
                cursor: pointer;
                transition: transform 0.2s;
            }
            .themeDots .dot.light { background-color: #FFFFFF; }
            .themeDots .dot.dark { background-color: #000000; }
            .themeDots .dot.basic { background-color: var(--quinary-color); }
            .themeDots .dot:hover { transform: scale(1.2); }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('.themeDots .dot.light')?.addEventListener('click', () => document.body.setAttribute('data-theme', 'light'));
                document.querySelector('.themeDots .dot.dark')?.addEventListener('click', () => document.body.setAttribute('data-theme', 'dark'));
                document.querySelector('.themeDots .dot.basic')?.addEventListener('click', () => document.body.setAttribute('data-theme', 'basic'));
            });
        </script>
    </header>

    <main>
        <!-- Warning about ToshiMart -->
        <div class="warning-note">
            <p>‚ö†Ô∏è <strong>Important Update:</strong> We have withdrawn from ToshiMart due to phishing concerns. Our new INPI token is <code>0x232FB12582ac10d5fAd97e9ECa22670e8Ba67d0D</code>. All official contracts are listed on our <a href="index.html">homepage</a>. Do not interact with the old token or ToshiMart pools.</p>
        </div>

        <!-- Partners Section (ToshiMart removed) -->
        <div class="partners-section">
            <div class="partner-item"><a href="https://base.org/" target="_blank">‚ö° Base L2</a></div>
            <div class="partner-item"><a href="https://uniswap.org/" target="_blank">ü¶Ñ Uniswap</a></div>
        </div>

        <div class="staking-container">
            <h1>‚ö° Stake $INPI, Earn Rewards</h1>

            <!-- Wallet Connection Bar -->
            <div class="wallet-bar">
                <div class="wallet-info">
                    <button id="connectWalletBtn" class="connect-wallet-btn">üîå Connect Wallet</button>
                    <span id="walletStatus" class="wallet-details" style="display: none;"></span>
                </div>
                <div id="tokenBalanceInfo" style="display: none;">
                    <span class="wallet-details">INPI: <span id="tokenBalance">0</span></span>
                </div>
            </div>

            <!-- Staking Info Panel -->
            <div class="balance-panel">
                <div class="balance-card">
                    <h3>Your Staked INPI</h3>
                    <div class="value" id="stakedBalance">0</div>
                    <div class="label">Currently staked</div>
                </div>
                <div class="balance-card">
                    <h3>Pending Rewards</h3>
                    <div class="value" id="pendingRewards">0</div>
                    <div class="label">Claimable INPI</div>
                </div>
                <div class="balance-card">
                    <h3>Total Staked</h3>
                    <div class="value" id="totalStaked">0</div>
                    <div class="label">Across all users</div>
                </div>
            </div>

            <!-- Reward Rate Info -->
            <div class="reward-rate">
                <div class="rate-item">
                    <div class="value" id="ratePerSecond">0</div>
                    <div>INPI/sec</div>
                </div>
                <div class="rate-item">
                    <div class="value" id="ratePerDay">0</div>
                    <div>INPI/day</div>
                </div>
                <div class="rate-item">
                    <div class="value" id="ratePerYear">0</div>
                    <div>INPI/year</div>
                </div>
            </div>

            <!-- Stake Form -->
            <div class="staking-form">
                <h2>Stake INPI</h2>
                <div class="form-group">
                    <label for="stakeAmount">Amount to Stake</label>
                    <input type="number" id="stakeAmount" placeholder="e.g. 1000" step="any">
                </div>
                <div class="button-group">
                    <button id="stakeBtn" class="action-btn" disabled>üîí Stake</button>
                    <button id="unstakeBtn" class="action-btn secondary" disabled>üîì Unstake</button>
                </div>
                <div class="info-note">
                    <strong>Note:</strong> Staking rewards accumulate continuously based on your share of the total staked pool. You can claim rewards at any time.
                </div>
            </div>

            <!-- Claim Form -->
            <div class="staking-form">
                <h2>Claim Rewards</h2>
                <div class="form-group">
                    <label for="claimAmount">Available: <span id="claimableAmount">0</span> INPI</label>
                </div>
                <button id="claimBtn" class="action-btn" disabled>üí∞ Claim Rewards</button>
                <div class="info-note">
                    <strong>Tip:</strong> Claiming does not unstake your tokens. Rewards are sent directly to your wallet.
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>¬© 2026 Inpinity. All rights reserved. Working with <a href="https://base.org/" target="_blank" rel="noopener" style="color: gold;">Base</a> and <a href="https://uniswap.org/" target="_blank" rel="noopener" style="color: gold;">Uniswap</a>.</p>
        <div class="footer-links">
            <a href="privacypolicy.html">Privacy Policy</a>
            <a href="termsofuse.html">Terms of Use</a>
            <a href="contact.html">Contact</a>
            <a href="faq.html">FAQ</a>
            <a href="guestbook.html">Guestbook</a>
            <a href="advertising.html">Advertising</a>
            <a href="profile.html">Profile</a>
            <a href="staking.html">Staking</a>
        </div>
    </footer>

    <script>
        (function() {
            // ========== Configuration ==========
            const TOKEN_ADDRESS = '0x232FB12582ac10d5fAd97e9ECa22670e8Ba67d0D'; // new INPI token
            const STAKING_ADDRESS = '0xF8c74E4fEe036C91228268E804f83eD8f55a6524'; // staking contract

            // Minimal ERC-20 ABI
            const TOKEN_ABI = [
                "function balanceOf(address owner) view returns (uint256)",
                "function decimals() view returns (uint8)",
                "function symbol() view returns (string)",
                "function transfer(address to, uint amount) returns (bool)",
                "function approve(address spender, uint256 amount) returns (bool)",
                "function allowance(address owner, address spender) view returns (uint256)"
            ];

            // Staking contract ABI (simplified, based on our staking.sol)
            const STAKING_ABI = [
                "function stake(uint256 amount) external",
                "function withdraw(uint256 amount) external",
                "function getReward() external",
                "function balanceOf(address account) view returns (uint256)",
                "function earned(address account) view returns (uint256)",
                "function totalSupply() view returns (uint256)",
                "function rewardRate() view returns (uint256)"
            ];

            // ========== DOM Elements ==========
            const connectBtn = document.getElementById('connectWalletBtn');
            const walletStatus = document.getElementById('walletStatus');
            const tokenBalanceInfo = document.getElementById('tokenBalanceInfo');
            const tokenBalanceSpan = document.getElementById('tokenBalance');
            const stakedBalanceSpan = document.getElementById('stakedBalance');
            const pendingRewardsSpan = document.getElementById('pendingRewards');
            const totalStakedSpan = document.getElementById('totalStaked');
            const ratePerSecondSpan = document.getElementById('ratePerSecond');
            const ratePerDaySpan = document.getElementById('ratePerDay');
            const ratePerYearSpan = document.getElementById('ratePerYear');
            const stakeAmountInput = document.getElementById('stakeAmount');
            const stakeBtn = document.getElementById('stakeBtn');
            const unstakeBtn = document.getElementById('unstakeBtn');
            const claimBtn = document.getElementById('claimBtn');
            const claimableAmountSpan = document.getElementById('claimableAmount');

            // ========== State ==========
            let provider, signer, userAddress = null;
            let tokenContract, stakingContract;
            let decimals = 18;
            let userBalance = 0;
            let stakedBalance = 0;
            let earnedBalance = 0;
            let totalStaked = 0;
            let rewardRate = 0;
            let intervalId = null;

            // ========== Helper Functions ==========
            function formatAddress(address) {
                if (!address) return '';
                return address.substring(0, 6) + '...' + address.substring(address.length - 4);
            }

            function formatUnits(value, decimals) {
                return Number(ethers.formatUnits(value, decimals)).toLocaleString(undefined, { maximumFractionDigits: 2 });
            }

            function parseUnits(value, decimals) {
                return ethers.parseUnits(value.toString(), decimals);
            }

            async function updateBalances() {
                if (!userAddress || !provider) return;

                try {
                    // Token balance of user
                    const tokenBalWei = await tokenContract.balanceOf(userAddress);
                    userBalance = tokenBalWei;
                    tokenBalanceSpan.textContent = formatUnits(tokenBalWei, decimals);

                    // Staked balance of user
                    const stakedWei = await stakingContract.balanceOf(userAddress);
                    stakedBalance = stakedWei;
                    stakedBalanceSpan.textContent = formatUnits(stakedWei, decimals);

                    // Earned rewards
                    const earnedWei = await stakingContract.earned(userAddress);
                    earnedBalance = earnedWei;
                    pendingRewardsSpan.textContent = formatUnits(earnedWei, decimals);
                    claimableAmountSpan.textContent = formatUnits(earnedWei, decimals);

                    // Total staked
                    const totalWei = await stakingContract.totalSupply();
                    totalStaked = totalWei;
                    totalStakedSpan.textContent = formatUnits(totalWei, decimals);

                    // Reward rate
                    const rateWei = await stakingContract.rewardRate();
                    rewardRate = rateWei;
                    const ratePerSec = formatUnits(rateWei, decimals);
                    ratePerSecondSpan.textContent = ratePerSec;
                    const ratePerDay = (Number(ratePerSec) * 86400).toLocaleString(undefined, { maximumFractionDigits: 2 });
                    ratePerDaySpan.textContent = ratePerDay;
                    const ratePerYear = (Number(ratePerSec) * 31536000).toLocaleString(undefined, { maximumFractionDigits: 2 });
                    ratePerYearSpan.textContent = ratePerYear;

                    // Enable/disable buttons based on balances
                    stakeBtn.disabled = userBalance === 0n;
                    unstakeBtn.disabled = stakedBalance === 0n;
                    claimBtn.disabled = earnedBalance === 0n;
                } catch (err) {
                    console.error('Error updating balances:', err);
                }
            }

            // ========== Wallet Connection ==========
            async function connectWallet() {
                if (typeof window.ethereum === 'undefined') {
                    alert('MetaMask or another Web3 wallet is not installed.');
                    return;
                }
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();

                    walletStatus.textContent = `Connected: ${formatAddress(userAddress)}`;
                    walletStatus.style.display = 'inline-block';
                    connectBtn.textContent = '‚úÖ Connected';
                    connectBtn.disabled = true;

                    // Initialize contracts
                    tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
                    stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);

                    // Get token decimals
                    decimals = await tokenContract.decimals();

                    // Show token balance area
                    tokenBalanceInfo.style.display = 'inline-block';

                    // Update balances immediately
                    await updateBalances();

                    // Set up periodic refresh (every 15 seconds)
                    if (intervalId) clearInterval(intervalId);
                    intervalId = setInterval(updateBalances, 15000);

                } catch (err) {
                    console.error(err);
                    alert('Connection failed.');
                }
            }

            function disconnectWallet() {
                userAddress = null;
                provider = null;
                signer = null;
                tokenContract = null;
                stakingContract = null;
                walletStatus.style.display = 'none';
                connectBtn.textContent = 'üîå Connect Wallet';
                connectBtn.disabled = false;
                tokenBalanceInfo.style.display = 'none';
                if (intervalId) {
                    clearInterval(intervalId);
                    intervalId = null;
                }
                // Reset displays
                tokenBalanceSpan.textContent = '0';
                stakedBalanceSpan.textContent = '0';
                pendingRewardsSpan.textContent = '0';
                totalStakedSpan.textContent = '0';
                ratePerSecondSpan.textContent = '0';
                ratePerDaySpan.textContent = '0';
                ratePerYearSpan.textContent = '0';
                claimableAmountSpan.textContent = '0';
                stakeBtn.disabled = true;
                unstakeBtn.disabled = true;
                claimBtn.disabled = true;
            }

            // ========== Staking Actions ==========
            async function stake() {
                if (!userAddress) return alert('Please connect wallet.');
                const amount = stakeAmountInput.value.trim();
                if (!amount || isNaN(amount) || Number(amount) <= 0) return alert('Enter a valid amount.');
                try {
                    const amountWei = parseUnits(amount, decimals);
                    // Check allowance
                    const allowance = await tokenContract.allowance(userAddress, STAKING_ADDRESS);
                    if (allowance < amountWei) {
                        // Request approval
                        const approveTx = await tokenContract.approve(STAKING_ADDRESS, amountWei);
                        await approveTx.wait();
                    }
                    const stakeTx = await stakingContract.stake(amountWei);
                    await stakeTx.wait();
                    alert('Staking successful!');
                    await updateBalances();
                    stakeAmountInput.value = '';
                } catch (err) {
                    console.error(err);
                    alert('Staking failed: ' + err.message);
                }
            }

            async function unstake() {
                if (!userAddress) return alert('Please connect wallet.');
                const amount = stakeAmountInput.value.trim();
                if (!amount || isNaN(amount) || Number(amount) <= 0) return alert('Enter a valid amount.');
                try {
                    const amountWei = parseUnits(amount, decimals);
                    const unstakeTx = await stakingContract.withdraw(amountWei);
                    await unstakeTx.wait();
                    alert('Unstaking successful!');
                    await updateBalances();
                    stakeAmountInput.value = '';
                } catch (err) {
                    console.error(err);
                    alert('Unstaking failed: ' + err.message);
                }
            }

            async function claim() {
                if (!userAddress) return alert('Please connect wallet.');
                try {
                    const claimTx = await stakingContract.getReward();
                    await claimTx.wait();
                    alert('Rewards claimed!');
                    await updateBalances();
                } catch (err) {
                    console.error(err);
                    alert('Claim failed: ' + err.message);
                }
            }

            // ========== Event Listeners ==========
            connectBtn.addEventListener('click', connectWallet);
            stakeBtn.addEventListener('click', stake);
            unstakeBtn.addEventListener('click', unstake);
            claimBtn.addEventListener('click', claim);

            // Optionally disconnect when network changes (simplified, not implemented)

            // Check if already connected (e.g., after page reload)
            window.addEventListener('load', async () => {
                if (window.ethereum && window.ethereum.selectedAddress) {
                    await connectWallet();
                }
            });
        })();
    </script>
</body>
</html>
